{% extends "base.html" %}

{% block title %}Reports - Visitor Management System{% endblock %}

{% block content %}
<div class="content-with-sidebar">
    <!-- Page Header -->
    <div style="margin-bottom: 2rem;">
        <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; background: linear-gradient(135deg, #6366f1, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            <i class="bi bi-file-earmark-text"></i> Visitor Reports
        </h1>
        <p class="text-muted" style="font-size: 1.1rem;">
            Generate and view daily or monthly visitor reports
        </p>
    </div>

    <!-- Report Filters -->
    <div class="glass-card">
        <div class="glass-card-header">
            <h4>
                <i class="bi bi-funnel"></i>
                Filter Reports
            </h4>
        </div>

        <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
            <a href="{{ url_for('reports', type='daily', date=selected_date) }}" 
               class="btn {% if report_type == 'daily' %}btn-primary{% else %}btn-outline{% endif %}"
               style="text-decoration: none;">
                <i class="bi bi-calendar-day"></i>
                <span>Daily Report</span>
            </a>
            <a href="{{ url_for('reports', type='monthly', month=selected_month) }}" 
               class="btn {% if report_type == 'monthly' %}btn-primary{% else %}btn-outline{% endif %}"
               style="text-decoration: none;">
                <i class="bi bi-calendar-month"></i>
                <span>Monthly Report</span>
            </a>
        </div>

        {% if report_type == 'daily' %}
        <form method="GET" action="{{ url_for('reports') }}" style="display: flex; gap: 1rem; align-items: end;">
            <input type="hidden" name="type" value="daily">
            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                <label for="date" class="form-label">Select Date</label>
                <input type="date" 
                       class="form-control" 
                       id="date" 
                       name="date" 
                       value="{{ selected_date }}" 
                       required>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-search"></i>
                <span>Generate Report</span>
            </button>
        </form>
        {% else %}
        <form method="GET" action="{{ url_for('reports') }}" style="display: flex; gap: 1rem; align-items: end;">
            <input type="hidden" name="type" value="monthly">
            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                <label for="month" class="form-label">Select Month</label>
                <input type="month" 
                       class="form-control" 
                       id="month" 
                       name="month" 
                       value="{{ selected_month }}" 
                       required>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-search"></i>
                <span>Generate Report</span>
            </button>
        </form>
        {% endif %}
    </div>

    <!-- Report Results -->
    <div class="glass-card">
        <div class="glass-card-header" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h4>
                    <i class="bi bi-list-ul"></i>
                    {% if report_type == 'daily' %}
                        Daily Report - {{ selected_date }}
                    {% else %}
                        Monthly Report - {{ selected_month }}
                    {% endif %}
                </h4>
                <p class="text-muted" style="margin-top: 0.5rem; font-size: 0.9rem; margin-bottom: 0;">
                    Total visitors: <strong style="color: #6366f1;">{{ visitors|length }}</strong>
                </p>
            </div>
        </div>

        {% if visitors %}
        <div style="overflow-x: auto;">
            <table class="glass-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Visitor</th>
                        <th>Contact</th>
                        <th>ID Proof</th>
                        <th>Person to Meet</th>
                        <th>Purpose</th>
                        <th>Check-In</th>
                        <th>Check-Out</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for visitor in visitors %}
                    <tr>
                        <td>
                            <strong style="color: #6366f1;">#{{ visitor.visitor_id }}</strong>
                        </td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="avatar">
                                    {{ visitor.name[0].upper() }}
                                </div>
                                <span style="color: var(--text-primary); font-weight: 500;">{{ visitor.name }}</span>
                            </div>
                        </td>
                        <td>{{ visitor.contact }}</td>
                        <td>{{ visitor.id_proof }}</td>
                        <td>{{ visitor.person_to_meet }}</td>
                        <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            {{ visitor.purpose }}
                        </td>
                        <td>
                            {% if visitor.check_in_time %}
                                {{ visitor.check_in_time.strftime('%Y-%m-%d %H:%M') }}
                            {% else %}
                                <span class="text-muted">N/A</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if visitor.check_out_time %}
                                {{ visitor.check_out_time.strftime('%Y-%m-%d %H:%M') }}
                            {% else %}
                                <span class="text-muted">â€”</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if visitor.status == 'INSIDE' %}
                                <span class="badge badge-inside">INSIDE</span>
                            {% else %}
                                <span class="badge badge-exited">EXITED</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
            <i class="bi bi-inbox" style="font-size: 3rem; opacity: 0.3; margin-bottom: 1rem; display: block;"></i>
            <p style="font-size: 1.1rem;">No visitors found for the selected period.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

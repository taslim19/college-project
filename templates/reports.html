{% extends "base.html" %}

{% block title %}Reports - Visitor Management System{% endblock %}

{% block content %}
<div class="content-with-sidebar">
    <!-- Page Header -->
    <div class="page-header">
        <div>
            <h1>
                <i class="bi bi-file-earmark-text" style="color: #d97757; margin-right: 0.5rem;"></i>
                Visitor Reports
            </h1>
            <p>Generate and view daily or monthly visitor reports</p>
        </div>
    </div>

    <!-- Report Filters -->
    <div class="glass-pad">
        <div style="margin-bottom: 1.5rem;">
            <div class="section-header">FILTER REPORTS</div>
        </div>

        <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1.5rem;">
            <a href="{{ url_for('reports', type='daily', date=selected_date) }}" 
               class="btn {% if report_type == 'daily' %}btn-primary{% else %}btn-outline{% endif %}"
               style="text-decoration: none;">
                <i class="bi bi-calendar-day"></i>
                <span>Daily Report</span>
            </a>
            <a href="{{ url_for('reports', type='monthly', month=selected_month) }}" 
               class="btn {% if report_type == 'monthly' %}btn-primary{% else %}btn-outline{% endif %}"
               style="text-decoration: none;">
                <i class="bi bi-calendar-month"></i>
                <span>Monthly Report</span>
            </a>
        </div>

        {% if report_type == 'daily' %}
        <form method="GET" action="{{ url_for('reports') }}" style="display: flex; gap: 1rem; align-items: end;">
            <input type="hidden" name="type" value="daily">
            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                <label for="date" class="form-label">Select Date</label>
                <input type="date" 
                       class="form-control" 
                       id="date" 
                       name="date" 
                       value="{{ selected_date }}" 
                       required>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-search"></i>
                <span>Generate Report</span>
            </button>
        </form>
        {% else %}
        <form method="GET" action="{{ url_for('reports') }}" style="display: flex; gap: 1rem; align-items: end;">
            <input type="hidden" name="type" value="monthly">
            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                <label for="month" class="form-label">Select Month</label>
                <input type="month" 
                       class="form-control" 
                       id="month" 
                       name="month" 
                       value="{{ selected_month }}" 
                       required>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-search"></i>
                <span>Generate Report</span>
            </button>
        </form>
        {% endif %}
    </div>

    <!-- Report Results -->
    <div class="glass-pad">
        <div style="margin-bottom: 1.5rem;">
            <h2 style="font-size: 1.5rem; font-weight: 700; color: #1e293b; margin-bottom: 0.5rem;">
                {% if report_type == 'daily' %}
                    Daily Report - {{ selected_date }}
                {% else %}
                    Monthly Report - {{ selected_month }}
                {% endif %}
            </h2>
            <p style="color: #64748b; font-size: 0.95rem;">
                Total visitors: <strong style="color: #d97757;">{{ visitors|length }}</strong>
            </p>
        </div>

        {% if visitors %}
        <div style="overflow-x: auto;">
            <table class="glass-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Visitor</th>
                        <th>Contact</th>
                        <th>ID Proof</th>
                        <th>Person to Meet</th>
                        <th>Purpose</th>
                        <th>Check-In</th>
                        <th>Check-Out</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for visitor in visitors %}
                    <tr>
                        <td>
                            <strong style="color: #d97757;">#{{ visitor.visitor_id }}</strong>
                        </td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="avatar">
                                    {{ visitor.name[0].upper() }}
                                </div>
                                <span style="color: #1e293b; font-weight: 500;">{{ visitor.name }}</span>
                            </div>
                        </td>
                        <td style="color: #64748b;">{{ visitor.contact }}</td>
                        <td style="color: #64748b;">{{ visitor.id_proof }}</td>
                        <td style="color: #64748b;">{{ visitor.person_to_meet }}</td>
                        <td style="color: #64748b; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            {{ visitor.purpose }}
                        </td>
                        <td style="color: #64748b;">
                            {% if visitor.check_in_time %}
                                {{ visitor.check_in_time.strftime('%Y-%m-%d %H:%M') }}
                            {% else %}
                                <span style="color: #94a3b8;">N/A</span>
                            {% endif %}
                        </td>
                        <td style="color: #64748b;">
                            {% if visitor.check_out_time %}
                                {{ visitor.check_out_time.strftime('%Y-%m-%d %H:%M') }}
                            {% else %}
                                <span style="color: #94a3b8;">â€”</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if visitor.status == 'INSIDE' %}
                                <span class="badge badge-inside">INSIDE</span>
                            {% else %}
                                <span class="badge badge-exited">EXITED</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <i class="bi bi-inbox"></i>
            <p>No visitors found for the selected period.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
